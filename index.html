<div id="center-stage">
    <div class="video-container" id="video-wrapper">
        <video id="main-display" autoplay playsinline></video>
        <video id="commander-pip" autoplay playsinline muted></video>
    </div>
</div>

<script>
    let isPIP = true;
    let cameraStream = null;
    // å›ºå®šæˆ¿é–“åç¨±ï¼Œæ–¹ä¾¿å­¸å“¡åŠ å…¥
    const roomName = "è‘‰è€å¸«ç·šä¸Šå…è²»èª²ç¨‹"; 
    const jitsiUrl = `https://meet.jit.si/${encodeURIComponent(roomName)}`;

    // ä¿®æ”¹å¾Œçš„ç›´æ’­èª²ç¨‹å»ºç«‹é‚è¼¯
    function createLiveClass() {
        const btn = document.getElementById('live-btn');
        const wrapper = document.getElementById('video-wrapper');
        const mainDisplay = document.getElementById('main-display');

        if (btn.classList.toggle('active-blue')) {
            btn.innerText = "ç›´æ’­ä¸­...";
            addLog(`ğŸ“¡ ç›´æ’­æ•™å®¤å·²å•Ÿå‹• [2026-02-02]`); 
            addLog(`ğŸ”— å­¸å“¡é€£çµï¼š${jitsiUrl}`); 

            // å°‡ä¸­å¤®ç•«é¢æ›¿æ›ç‚º Jitsi Iframe
            wrapper.innerHTML = `
                <iframe 
                    allow="camera; microphone; fullscreen; display-capture; autoplay" 
                    src="${jitsiUrl}" 
                    style="width: 100%; height: 100%; border: 0;">
                </iframe>
                <video id="commander-pip" autoplay playsinline muted></video>
            `;
            
            // é‡æ–°å•Ÿå‹•å³ä¸Šè§’çš„å°é¡é ­
            setTimeout(() => {
                const pip = document.getElementById('commander-pip');
                if (cameraStream) pip.srcObject = cameraStream;
            }, 500);

        } else {
            btn.innerText = "ç›´æ’­èª²ç¨‹";
            addLog("â¹ï¸ ç›´æ’­å·²é—œé–‰ï¼Œåˆ‡æ›å›ç›£æ§æ¨¡å¼");
            location.reload(); // é‡æ•´é é¢ä»¥æ¢å¾©åŸå§‹ç›¸æ©Ÿç‹€æ…‹
        }
    }

    async function startVideo() {
        try {
            cameraStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
            const pip = document.getElementById('commander-pip');
            const main = document.getElementById('main-display');
            if (pip) pip.srcObject = cameraStream;
            if (main) main.srcObject = cameraStream;
            addLog("ğŸ¥ ç¶²è·¯ç›¸æ©Ÿé€£ç·šæˆåŠŸ [2026-02-02]"); 
        } catch (e) { 
            addLog("âš ï¸ ç›¸æ©Ÿå•Ÿå‹•å¤±æ•—ï¼Œè«‹ç¢ºèªæ¬Šé™"); 
        }
    }

    // ... å…¶é¤˜ setScale, toggleRec, toggleBC ç­‰ function ä¿æŒä¸è®Š ...
</script>
